<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Planazoo v9 (fases + login)</title>
  <meta name="theme-color" id="meta-theme" content="#fff"/>
  <link rel="manifest" href="manifest.json"/>
  <!-- (Eliminado el favicon inline para mantener el logo original) -->
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
<div class="app">

<!-- Sprite con el logo oficial (reemplaza TODO tu bloque <svg ...><symbol id="m">...</symbol></svg> por este) -->
<svg aria-hidden="true" focusable="false" style="position:absolute;width:0;height:0">
  <symbol id="m" viewBox="0 0 330.67 309.33" preserveAspectRatio="xMidYMid meet">
    <defs>
      <style>
        .st0 { fill: #6a5af3; }
        .st1 { stroke-width: .25px; }
        .st1, .st2, .st3 { fill: #8c583d; }
        .st1, .st4, .st5, .st3 { stroke: #000; }
        .st1, .st5 { stroke-miterlimit: 10; }
        .st6 { fill: #fff; }
        .st7 { fill: #ffd597; }
        .st4 { fill: none; }
        .st4, .st5, .st3 { stroke-width: 8px; }
        .st4, .st3 { stroke-linecap: round; stroke-linejoin: round; }
        .st5 { fill: #fbca88; }
      </style>
    </defs>
    <rect class="st0" height="269" rx="53.67" ry="53.67" width="275" x="26.97" y="27.06"></rect>
    <path class="st5" d="M84.09,134.14c-5.62-1.66-11.54-1.6-17.1.57-15.27,5.96-21.99,25.48-15.02,43.6,6.24,16.23,21.35,23.83,35.41,21.38l15.23-26.39-18.52-39.15Z"></path>
    <path class="st5" d="M247.04,134.68c5.62-1.66,11.54-1.6,17.1.57,15.27,5.96,21.99,25.48,15.02,43.6-6.24,16.23-21.35,23.83-35.41,21.38l-16.58-26,19.87-39.55Z"></path>
    <g>
      <path class="st2" d="M165.58,266.11c-41.58,0-75.42-27.14-75.42-60.5,0-6.37,1.25-12.68,3.72-18.74l.72-1.78-.93-1.68c-6.09-10.93-9.18-22.73-9.18-35.09,0-20.02,8.37-38.5,23.58-52.05,15.13-13.48,35.55-20.9,57.5-20.9s42.37,7.42,57.5,20.9c15.21,13.55,23.58,32.03,23.58,52.05,0,12.36-3.09,24.16-9.18,35.09l-.93,1.68.72,1.78c2.47,6.07,3.72,12.37,3.72,18.74,0,33.36-33.83,60.5-75.42,60.5Z"></path>
      <path d="M165.58,79.37c20.97,0,40.44,7.06,54.84,19.89,14.34,12.78,22.24,30.2,22.24,49.06,0,11.67-2.92,22.82-8.67,33.14l-1.87,3.35,1.45,3.56c2.27,5.59,3.43,11.39,3.43,17.24,0,31.15-32.04,56.5-71.42,56.5s-71.42-25.35-71.42-56.5c0-5.85,1.15-11.65,3.43-17.24l1.45-3.56-1.87-3.35c-5.75-10.32-8.67-21.47-8.67-33.14,0-18.86,7.9-36.28,22.24-49.06,14.4-12.83,33.87-19.89,54.84-19.89M165.58,71.37c-46.99,0-85.08,32.8-85.08,76.96,0,13.37,3.51,25.96,9.68,37.04-2.59,6.37-4.02,13.17-4.02,20.25,0,35.62,35.56,64.5,79.42,64.5s79.42-28.88,79.42-64.5c0-7.08-1.42-13.88-4.02-20.25,6.17-11.08,9.68-23.67,9.68-37.04,0-44.16-38.09-76.96-85.08-76.96h0Z"></path>
    </g>
    <g>
      <path class="st7" d="M165.69,266.11c-32.85,0-59.58-23.21-59.58-51.74,0-10.19,3.42-20.05,9.88-28.52l2.56-3.36-3.49-2.38c-9.59-6.52-15.32-17.33-15.32-28.91,0-19.26,15.67-34.93,34.93-34.93,10.75,0,20.74,4.85,27.42,13.31l3.14,3.97,3.14-3.97c6.68-8.46,16.67-13.31,27.42-13.31,19.26,0,34.93,15.67,34.93,34.93,0,11.31-5.52,21.97-14.78,28.52l-3.42,2.42,2.57,3.3c6.66,8.56,10.18,18.56,10.18,28.92,0,28.53-26.73,51.74-59.58,51.74Z"></path>
      <path d="M195.78,120.28c17.06,0,30.93,13.88,30.93,30.93,0,10.01-4.89,19.45-13.09,25.26l-6.83,4.84,5.14,6.61c6.11,7.85,9.34,17,9.34,26.46,0,26.33-24.93,47.74-55.58,47.74s-55.58-21.42-55.58-47.74c0-9.3,3.13-18.32,9.06-26.09l5.12-6.72-6.99-4.75c-8.5-5.78-13.57-15.35-13.57-25.6,0-17.06,13.88-30.93,30.93-30.93,9.52,0,18.37,4.3,24.28,11.79l6.28,7.95,6.28-7.95c5.92-7.49,14.77-11.79,24.28-11.79M195.78,112.28c-12.4,0-23.43,5.8-30.56,14.83-7.13-9.03-18.16-14.83-30.56-14.83-21.5,0-38.93,17.43-38.93,38.93,0,13.4,6.77,25.21,17.07,32.22-6.75,8.85-10.7,19.49-10.7,30.94,0,30.79,28.47,55.74,63.58,55.74s63.58-24.96,63.58-55.74c0-11.64-4.07-22.44-11.03-31.37,9.96-7.05,16.47-18.65,16.47-31.78,0-21.5-17.43-38.93-38.93-38.93h0Z"></path>
    </g>
    <path d="M82.36,156.71s-11.17,1.44-17.28,13.67c0,0-4.39-15.06,16.83-21.5l.44,7.83Z"></path>
    <path d="M248.87,156.86s11.17,1.44,17.28,13.67c0,0,4.39-15.06-16.83-21.5l-.44,7.83Z"></path>
    <g>
      <path d="M135.26,168.06c-6.04,0-10.96-5.7-10.96-12.71s4.92-12.71,10.96-12.71,10.96,5.7,10.96,12.71-4.92,12.71-10.96,12.71Z"></path>
      <path d="M135.26,146.64c3.77,0,6.96,3.99,6.96,8.71s-3.19,8.71-6.96,8.71-6.96-3.99-6.96-8.71,3.19-8.71,6.96-8.71M135.26,138.64c-8.26,0-14.96,7.48-14.96,16.71s6.7,16.71,14.96,16.71,14.96-7.48,14.96-16.71-6.7-16.71-14.96-16.71h0Z"></path>
    </g>
    <ellipse class="st6" cx="140.43" cy="149.87" rx="5.04" ry="4.43" transform="translate(-26.49 269.53) rotate(-82.5)"></ellipse>
    <g>
      <path d="M195.06,168.06c-6.04,0-10.96-5.7-10.96-12.71s4.92-12.71,10.96-12.71,10.96,5.7,10.96,12.71-4.92,12.71-10.96,12.71Z"></path>
      <path d="M195.06,146.64c3.77,0,6.96,3.99,6.96,8.71s-3.19,8.71-6.96,8.71-6.96-3.99-6.96-8.71,3.19-8.71,6.96-8.71M195.06,138.64c-8.26,0-14.96,7.48-14.96,16.71s6.7,16.71,14.96,16.71,14.96-7.48,14.96-16.71-6.7-16.71-14.96-16.71h0Z"></path>
    </g>
    <ellipse class="st6" cx="200.23" cy="149.87" rx="5.04" ry="4.43" transform="translate(25.5 328.82) rotate(-82.5)"></ellipse>
    <circle cx="157.22" cy="190.14" r="4.39"></circle>
    <circle cx="174.44" cy="190.14" r="4.39"></circle>
    <path class="st4" d="M185.48,188.19c.06-.46.11-.92.11-1.4,0-6.13-5.38-11.1-12.02-11.1-2.93,0-5.61.97-7.69,2.58-2.08-1.61-4.76-2.58-7.69-2.58-6.64,0-12.02,4.97-12.02,11.1,0,.47.04.94.11,1.4"></path>
    <path class="st4" d="M124.25,205.22c1.81,12.93,19.41,23.08,40.88,23.08s39.07-10.15,40.88-23.08"></path>
    <path class="st4" d="M124.25,205.22"></path>
    <path class="st4" d="M206.01,205.22"></path>
    <path class="st2" d="M179.64,52.04c-5.62-.77-13.39,9.66-18.97,18.66-1.11-3.39-2.86-7.34-5.2-8.19-4.25-1.56-10.08,11.74-11.5,17.82-.92,3.96,4.73,5.73,8.79,6.49-.92,5.68-.18,14.65,18.71,1.01,25.67-18.53,17.92-34.44,8.17-35.78Z"></path>
    <path class="st1" d="M143.97,77.71c-.06.32-.1.63-.1.93"></path>
    <path class="st3" d="M178.54,84.75c16.04-15.23,10.73-31.55,1.65-32.71-6.04-.77-12.25,12.21-18.26,21.2-1.19-3.39-4.16-9.88-6.67-10.74-4.57-1.56-9.77,11.74-11.3,17.82"></path>
  </symbol>
</svg>

  <div class="appbar">
    <svg class="logo" viewBox="0 0 512 512"><use href="#m"></use></svg><div class="t">Planazoo</div>
    <div class="sp"></div>
    <button id="th" class="ib" title="Tema">🌓</button>
    <button class="ib" onclick="openPrefs()" title="Preferencias">⚙️</button>
    <button id="abtn" class="ib avatarbtn" title="Cuenta">
      <div id="aico" class="avatar">?</div><small id="aname" class="pill">Invitado</small>
    </button>
    <div id="amenu" class="menu">
      <a href="#" onclick="openLogin();return false;">👤 Iniciar sesión</a>
      <a href="#" onclick='tab("stats");closeMenu();return false;'>📊 Estadísticas</a>
      <a href="#" onclick="logout();return false;">↩️ Cerrar sesión</a>
    </div>
  </div>

  <div class="content">
    <section id="home" class="view on">
      <div class="card"><div class="row">
        <svg class="lg" viewBox="0 0 512 512"><use href="#m"></use></svg><div><h2 style="margin:0">Decide planes en grupo</h2><small class="pill">Rápido y sin discusiones</small></div>
      </div><div class="row" style="margin-top:8px"><button class="btn p" onclick='tab("crear")'>Crear plan</button><span class="pill">🔔 Recordatorios</span><span class="pill">✨ Sugerencias</span></div></div>
      <div class="card" style="margin-top:12px"><h3>Lo mejor de la comunidad</h3><div id="homec" class="grid cards"></div></div>
    </section>

    <!-- CREAR (wizard en 4 fases) -->
    <section id="crear" class="view">
      <div class="card">
        <h2>Crear plan</h2>
        <div class="steps">
          <div class="step" data-s="1"><div class="dot">1</div><small class="pill">Detalles</small></div>
          <div class="step" data-s="2"><div class="dot">2</div><small class="pill">Invitados</small></div>
          <div class="step" data-s="3"><div class="dot">3</div><small class="pill">Actividades</small></div>
          <div class="step" data-s="4"><div class="dot">4</div><small class="pill">Compartir</small></div>
        </div>

        <!-- Paso 1: detalles -->
        <div id="s1" class="substep">
          <div class="row">
            <div class="col" style="flex:2"><label>Título</label><input id="pt" class="input" value="Planazoo de hoy"></div>
            <div class="col" style="flex:1"><label>Fecha y hora</label><input id="pd" class="input" type="datetime-local"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <div class="col" style="flex:1"><label>Ciudad</label><input id="pc" class="input" placeholder="Ciudad"></div>
            <div class="col" style="flex:1"><label>Tiempo para votar (min)</label><input id="pl" class="input" type="number" min="10" max="1440" value="120"></div>
          </div>
        </div>

        <!-- Paso 2: invitados -->
        <div id="s2" class="substep">
          <h3>Invitar amigos</h3>
          <div id="chips" class="row"></div>
          <div class="row"><input id="fnew" class="input" placeholder="Añadir amigo (@usuario o nombre)"><button class="btn" onclick="addFriendInput()">Añadir</button><button class="btn" onclick="manageFriends()">Gestionar</button></div>
        </div>

        <!-- Paso 3: actividades -->
        <div id="s3" class="substep">
          <div class="row"><button class="btn s" onclick="openMSug(); genSugUI()">Generar sugerencias</button><small class="pill">Según preferencias</small></div>
          <div id="sugs" class="grid cards" style="margin-top:12px"></div>
          <h3 style="margin-top:14px">Opciones del plan</h3>
          <div id="opts" class="grid"></div>
          <h3 style="margin-top:14px">Tus favoritos</h3>
          <div id="favpick" class="grid cards"></div>
          <div class="row" style="margin-top:8px"><button class="btn" onclick="addManual()">+ Opción manual</button></div>
        </div>

        <!-- Paso 4: compartir -->
        <div id="s4" class="substep">
          <h3>Resumen</h3>
          <div id="sum" class="grid cards"></div>
          <div class="row" style="margin-top:10px">
            <button class="btn p" onclick="createShare()">Crear y compartir</button>
            <button class="btn" onclick="sharePreview()">Vista previa de enlace</button>
          </div>
        </div>

        <hr>
        <div class="row">
          <button id="pb" class="btn s" onclick="prevStep()">← Atrás</button>
          <div style="flex:1"></div>
          <button id="pn" class="btn s p" onclick="nextStep()">Continuar →</button>
        </div>
      </div>
    </section>

    <section id="votar" class="view"><div class="card">
      <div class="row"><h2 id="vt">Vota</h2><span class="pill" id="collab">Colaborativo</span></div>
      <small>Se cierra en: <span id="rem">—</span></small><div class="row" style="margin-top:12px"><input id="vn" class="input" placeholder="Tu nombre"></div><hr>
      <div id="vlist" class="grid"></div><div class="row" style="margin-top:8px"><button class="btn s" onclick="contrib()">+ Añadir opción</button></div><hr>
      <div class="row"><button class="btn p" onclick="goRes()">Ver resultados</button><button class="btn" onclick="share()">Compartir</button><small>Enlace: <span id="link" class="link"></span></small></div>
    </div></section>

    <section id="res" class="view"><div class="card">
      <div class="row"><h2 id="rt">Resultado</h2><span class="pill" id="state">—</span><div style="flex:1"></div><button class="btn" onclick="closeNow()">Cerrar</button></div><hr>
      <div id="rlist" class="grid"></div><hr><div id="win"></div>
      <div id="tie" style="display:none"><hr><h3>⚖️ Desempate</h3><div class="row"><button class="btn" onclick="tRand()">Aleatorio</button><button class="btn" onclick="tManual()">Elegir manual</button></div><div id="tieopts" class="grid cards" style="margin-top:10px"></div></div>
      <hr><div class="row"><button class="btn" onclick="share()">Compartir</button><button class="btn" onclick="publish()">Publicar en comunidad</button></div>
    </div></section>

    <section id="hist" class="view"><div class="card"><h2>Historial</h2><div id="hlist" class="grid cards"></div></div></section>
    <section id="favs" class="view"><div class="card"><h2>Favoritos</h2><div class="row"><input id="fvi" class="input" placeholder="Ej. Restaurante X"><button class="btn p" onclick="addFav()">Guardar</button></div><div id="fv" class="grid cards" style="margin-top:12px"></div></div></section>
    <section id="comm" class="view"><div class="card"><h2>Comunidad</h2><div id="clist" class="grid cards"></div></div></section>

    <!-- Stats (oculto del tabbar) -->
    <section id="stats" class="view"><div class="card"><h2>Estadísticas</h2><div id="sw" class="grid"></div></div></section>

    <section id="prefs" class="view"><div class="card"><h2>Preferencias</h2>
      <div class="row"><div class="col" style="flex:1"><label>Ciudad</label><input id="pcity" class="input"></div>
      <div class="col" style="flex:1"><label>Presupuesto</label><select id="pbud"><option value="bajo">Bajo</option><option value="medio" selected>Medio</option><option value="alto">Alto</option></select></div></div>
      <h3>Intereses</h3><div id="pints" class="grid" style="grid-template-columns:repeat(auto-fill,minmax(160px,1fr))"></div>
      <div class="row" style="margin-top:12px"><button class="btn p" onclick="savePrefs()">Guardar</button><button class="btn" onclick='tab("home")'>Cancelar</button></div>
    </div></section>
  </div>

  <nav class="tabbar">
    <div class="tab on" data-t="home"><div>🏠</div><small>Inicio</small></div>
    <div class="tab" data-t="crear"><div>➕</div><small>Crear</small></div>
    <div class="tab" data-t="hist"><div>🕘</div><small>Historial</small></div>
    <div class="tab" data-t="favs"><div>⭐</div><small>Favoritos</small></div>
    <div class="tab" data-t="comm"><div>🌍</div><small>Comunidad</small></div>
  </nav>

  <!-- Modales -->
  <div id="mf" class="modal"><div class="sheet"><div class="row"><h3>Gestionar amigos</h3><div style="flex:1"></div><button class="btn s" onclick="closeMF()">Cerrar</button></div><div class="row" style="margin-top:6px"><input id="mfnew" class="input" placeholder="Nombre o @usuario"><button class="btn" onclick="addFriendModal()">Añadir</button></div><div id="mfl" class="grid cards" style="margin-top:12px"></div></div></div>

  <div id="mr" class="modal"><div class="sheet"><div class="row"><h3>Valorar plan</h3><div style="flex:1"></div><button class="btn s" onclick="closeMR()">Cerrar</button></div><div id="rst" class="row"></div><div class="col" style="margin-top:6px"><label>Comentario</label><textarea id="rc" rows="3"></textarea></div><div class="row" style="margin-top:8px"><button class="btn p" onclick="saveRate()">Guardar valoración</button></div></div></div>

  <div id="msug" class="modal">
    <div class="sheet">
      <div class="row">
        <h3>Sugerencias</h3>
        <div style="flex:1"></div>
        <button class="btn s" onclick="closeMSug()">Cerrar</button>
      </div>
      <div class="row" style="margin-top:6px">
        <button class="btn s p" onclick="genSugUI()">↻ Generar más</button>
        <button class="btn s" onclick="addManual()">+ Añadir manual</button>
      </div>
      <div id="sugwrap" class="grid cards" style="margin-top:12px"></div>
      <small class="pill" style="margin-top:8px;display:inline-block">Puedes añadir varias sin cerrar este modal.</small>
    </div>
  </div>

  <div id="ml" class="modal"><div class="sheet"><div class="row"><h3>Iniciar sesión</h3><div style="flex:1"></div><button class="btn s" onclick="closeLogin()">Cerrar</button></div>
    <div class="row"><div class="col" style="flex:1"><label>Nombre</label><input id="ln" class="input" placeholder="Tu nombre"></div>
    <div class="col" style="flex:1"><label>Email</label><input id="le" class="input" type="email" placeholder="tucorreo@email.com"></div></div>
    <div class="row" style="margin-top:8px"><button class="btn p" onclick="doLogin()">Entrar</button><button class="btn" onclick="demoLogin()">Demo</button></div>
  </div></div>

</div>

<!-- Supabase + App scripts -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/app.js" defer></script>
<script src="js/enhancers.js" defer></script>
<script src="js/supabase-bootstrap.js" defer></script>
<script src="api-compound.js" defer></script>
</body>
</html>
